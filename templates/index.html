{% extends "base.html" %}
{% block title %}Sara的二手售卖网站 - 新西兰奥克兰优质二手商品{% endblock %}

{% block description %}Sara二手商品售卖网站，新西兰奥克兰地区优质二手商品专卖店。电子产品、服装、动漫周边等，品质保证，价格优惠，支持当面交易和邮寄服务。{% endblock %}

{% block keywords %}Sara,二手售卖,新西兰,奥克兰,二手商品,电子产品,服装,动漫周边,当面交易,邮寄{% endblock %}

{% block structured_data %}
{{ super() }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Store",
  "name": "Sara的二手售卖",
  "description": "新西兰奥克兰地区优质二手商品专卖店",
  "url": "{{ request.url }}",
  "telephone": "0225255862",
  "email": "haixialiu2017@gmail.com",
  "address": {
    "@type": "PostalAddress",
    "addressRegion": "Auckland",
    "addressCountry": "NZ"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": -36.8485,
    "longitude": 174.7633
  },
  "paymentAccepted": ["Cash", "Credit Card", "Bank Transfer"],
  "currenciesAccepted": "NZD"
}
</script>
{% endblock %}

{% block content %}
<section class="mb-10">
  <div class="flex flex-col md:flex-row items-center gap-8">
    <img src="https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=400&q=80" alt="二手物品" class="rounded-lg shadow-lg w-full md:w-1/3">
    <div>
      <h2 class="text-3xl font-bold text-orange-700 mb-4">欢迎来到Sara的二手售卖网站</h2>
      <p class="mb-4">我是Sara，来自奥克兰北岸，家中有多种高品质二手物品出售，欢迎新西兰各地朋友选购。支持面交与邮寄，购物体验安全、便捷、温馨。</p>
      <a href="{{ url_for('products') }}" class="inline-block bg-orange-500 text-white px-6 py-2 rounded shadow hover:bg-orange-600 transition">立即选购</a>
    </div>
  </div>
</section>
<section>
  <h3 class="text-xl font-semibold text-orange-700 mb-4">最新上架</h3>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    {% for product in products %}
    <div class="bg-white rounded-lg shadow p-4 flex flex-col">
      <a href="{{ url_for('product_detail', product_id=product.id) }}" class="block">
        <img src="{{ product.img }}" alt="{{ product.title }}" class="rounded mb-3 h-40 object-cover hover:opacity-90 transition cursor-pointer">
      </a>
      <div class="flex-1">
        <a href="{{ url_for('product_detail', product_id=product.id) }}" class="block hover:text-orange-600 transition">
          <h4 class="font-bold text-lg mb-1">{{ product.title }}</h4>
        </a>
        <p class="text-sm text-gray-600 mb-2">{{ product.desc }}</p>
        <span class="text-orange-600 font-semibold">{{ product.price }}</span>
      </div>
      <div class="mt-3 flex gap-2">
        <a href="{{ url_for('product_detail', product_id=product.id) }}" 
           class="flex-1 bg-orange-500 text-white py-1 px-2 rounded text-center text-sm hover:bg-orange-600 transition">
          查看详情
        </a>
        <button onclick="addToCart({{ product.id }})" 
                class="flex-1 bg-green-500 text-white py-1 px-2 rounded text-sm hover:bg-green-600 transition">
          加入购物车
        </button>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- JavaScript -->
<script>
// 添加到购物车功能
function addToCart(productId) {
  // 获取现有购物车数据
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');
  
  // 检查商品是否已在购物车中
  let existingItem = cart.find(item => item.id === productId);
  
  if (existingItem) {
    existingItem.quantity += 1;
    localStorage.setItem('cart', JSON.stringify(cart));
    showMessage('商品数量已更新！', 'success');
    updateCartCount();
  } else {
    // 调用API获取商品信息并添加到购物车
    fetch('/api/cart', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        product_id: productId,
        quantity: 1
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        cart.push({
          id: data.product.id,
          name: data.product.name,
          price: data.product.price,
          image: data.product.image,
          condition: data.product.condition,
          quantity: data.quantity
        });
        
        localStorage.setItem('cart', JSON.stringify(cart));
        showMessage('商品已加入购物车！', 'success');
        updateCartCount();
      } else {
        showMessage(data.message || '添加失败', 'error');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      showMessage('网络错误，请重试', 'error');
    });
  }
}

// 显示消息
function showMessage(message, type = 'info') {
  const messageDiv = document.createElement('div');
  messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
    type === 'success' ? 'bg-green-500 text-white' : 
    type === 'error' ? 'bg-red-500 text-white' : 
    'bg-blue-500 text-white'
  }`;
  messageDiv.textContent = message;
  
  document.body.appendChild(messageDiv);
  
  setTimeout(() => {
    document.body.removeChild(messageDiv);
  }, 3000);
}

// 更新购物车计数
function updateCartCount() {
  const cart = JSON.parse(localStorage.getItem('cart') || '[]');
  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  
  const cartCountElements = document.querySelectorAll('.cart-count');
  cartCountElements.forEach(element => {
    element.textContent = totalItems;
    element.style.display = totalItems > 0 ? 'inline' : 'none';
  });
}

// 页面加载时更新购物车计数
document.addEventListener('DOMContentLoaded', function() {
  updateCartCount();
});
</script>

{% endblock %}