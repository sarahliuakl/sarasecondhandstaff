{% extends "admin/base.html" %}

{% block title %}
    {% if item %}ç¼–è¾‘ä¿¡æ¯é¡¹ - {{ item.key }}{% else %}æ·»åŠ ä¿¡æ¯é¡¹ - {{ section.name }}{% endif %}
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{{ url_for('admin.site_info') }}" 
                   class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                    <i class="fas fa-info-circle mr-2"></i>ç«™ç‚¹ä¿¡æ¯ç®¡ç†
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-1"></i>
                    <a href="{{ url_for('admin.edit_section', section_id=(item.section_id if item else section.id)) }}" 
                       class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2">
                        {{ item.section.name if item else section.name }}
                    </a>
                </div>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-1"></i>
                    <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2">
                        {% if item %}ç¼–è¾‘ {{ item.key }}{% else %}æ·»åŠ ä¿¡æ¯é¡¹{% endif %}
                    </span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <div class="mb-8">
        <h2 class="text-2xl font-bold leading-7 text-gray-900 sm:text-3xl sm:truncate">
            {% if item %}
                <i class="fas fa-edit mr-3 text-blue-600"></i>ç¼–è¾‘ä¿¡æ¯é¡¹
            {% else %}
                <i class="fas fa-plus mr-3 text-green-600"></i>æ·»åŠ ä¿¡æ¯é¡¹
            {% endif %}
        </h2>
        <p class="mt-1 text-sm text-gray-500">
            {% if item %}
                ä¿®æ”¹ä¿¡æ¯é¡¹ "{{ item.key }}" çš„å†…å®¹å’Œè®¾ç½®
            {% else %}
                åœ¨ "{{ section.name }}" éƒ¨åˆ†æ·»åŠ æ–°çš„ä¿¡æ¯é¡¹
            {% endif %}
        </p>
    </div>

    <!-- ä¸»è¡¨å• -->
    <form method="POST" class="space-y-8">
        <div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6">
            <div class="md:grid md:grid-cols-3 md:gap-6">
                <div class="md:col-span-1">
                    <h3 class="text-lg font-medium leading-6 text-gray-900">åŸºæœ¬ä¿¡æ¯</h3>
                    <p class="mt-1 text-sm text-gray-500">
                        è®¾ç½®ä¿¡æ¯é¡¹çš„åŸºæœ¬å±æ€§å’Œç±»å‹
                    </p>
                </div>
                <div class="mt-5 md:mt-0 md:col-span-2">
                    <div class="grid grid-cols-6 gap-6">
                        <!-- æ ‡è¯†ç¬¦ -->
                        <div class="col-span-6 sm:col-span-3">
                            <label for="key" class="block text-sm font-medium text-gray-700">
                                æ ‡è¯†ç¬¦ <span class="text-red-500">*</span>
                            </label>
                            <input type="text" 
                                   name="key" 
                                   id="key" 
                                   value="{{ item.key if item else '' }}"
                                   required
                                   class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            <p class="mt-1 text-xs text-gray-500">è‹±æ–‡å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œç”¨äºç¨‹åºè¯†åˆ«</p>
                        </div>

                        <!-- ç±»å‹ -->
                        <div class="col-span-6 sm:col-span-3">
                            <label for="item_type" class="block text-sm font-medium text-gray-700">
                                ç±»å‹ <span class="text-red-500">*</span>
                            </label>
                            <select name="item_type" 
                                    id="item_type" 
                                    required
                                    onchange="toggleContentFields()"
                                    class="mt-1 block w-full py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                                {% for type_code, type_name in item_types %}
                                <option value="{{ type_code }}" 
                                        {% if item and item.item_type == type_code %}selected{% endif %}>
                                    {{ type_name }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- æ’åº -->
                        <div class="col-span-6 sm:col-span-3">
                            <label for="sort_order" class="block text-sm font-medium text-gray-700">æ’åºæƒé‡</label>
                            <input type="number" 
                                   name="sort_order" 
                                   id="sort_order" 
                                   value="{{ item.sort_order if item else 0 }}"
                                   class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            <p class="mt-1 text-xs text-gray-500">æ•°å­—è¶Šå°æ’åºè¶Šé å‰</p>
                        </div>

                        <!-- çŠ¶æ€ -->
                        <div class="col-span-6 sm:col-span-3">
                            <label class="block text-sm font-medium text-gray-700">çŠ¶æ€</label>
                            <div class="mt-1">
                                <label class="inline-flex items-center">
                                    <input type="checkbox" 
                                           name="is_active" 
                                           value="1"
                                           {% if not item or item.is_active %}checked{% endif %}
                                           class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                                    <span class="ml-2 text-sm text-gray-700">å¯ç”¨æ­¤ä¿¡æ¯é¡¹</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†…å®¹è®¾ç½® -->
        <div class="bg-white shadow px-4 py-5 sm:rounded-lg sm:p-6">
            <div class="md:grid md:grid-cols-3 md:gap-6">
                <div class="md:col-span-1">
                    <h3 class="text-lg font-medium leading-6 text-gray-900">å†…å®¹è®¾ç½®</h3>
                    <p class="mt-1 text-sm text-gray-500">
                        æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒçš„å†…å®¹å­—æ®µï¼Œæ”¯æŒä¸­è‹±æ–‡åŒè¯­
                    </p>
                </div>
                <div class="mt-5 md:mt-0 md:col-span-2">
                    <!-- æ–‡æœ¬ç±»å‹ -->
                    <div id="text_fields" class="content-fields" style="display: none;">
                        <div class="space-y-4">
                            <div>
                                <label for="text_value" class="block text-sm font-medium text-gray-700">æ–‡æœ¬å†…å®¹ï¼ˆä¸­æ–‡ï¼‰</label>
                                <textarea name="text_value" 
                                         id="text_value" 
                                         rows="3"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_content().get('value', '') if item else '' }}</textarea>
                            </div>
                            <div>
                                <label for="text_value_en" class="block text-sm font-medium text-gray-700">æ–‡æœ¬å†…å®¹ï¼ˆè‹±æ–‡ï¼‰</label>
                                <textarea name="text_value_en" 
                                         id="text_value_en" 
                                         rows="3"
                                         placeholder="å¯é€‰ï¼Œå¦‚éœ€è‹±æ–‡ç‰ˆæœ¬è¯·å¡«å†™"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_translated_content('en').get('value', '') if item else '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- è”ç³»ä¿¡æ¯ç±»å‹ -->
                    <div id="contact_fields" class="content-fields" style="display: none;">
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="contact_label" class="block text-sm font-medium text-gray-700">æ ‡ç­¾ï¼ˆä¸­æ–‡ï¼‰</label>
                                    <input type="text" 
                                           name="contact_label" 
                                           id="contact_label" 
                                           value="{{ item.get_content().get('label', '') if item else '' }}"
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="contact_value" class="block text-sm font-medium text-gray-700">å€¼</label>
                                    <input type="text" 
                                           name="contact_value" 
                                           id="contact_value" 
                                           value="{{ item.get_content().get('value', '') if item else '' }}"
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="contact_label_en" class="block text-sm font-medium text-gray-700">æ ‡ç­¾ï¼ˆè‹±æ–‡ï¼‰</label>
                                    <input type="text" 
                                           name="contact_label_en" 
                                           id="contact_label_en" 
                                           value="{{ item.get_translated_content('en').get('label', '') if item else '' }}"
                                           placeholder="å¯é€‰"
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="contact_value_en" class="block text-sm font-medium text-gray-700">å€¼ï¼ˆè‹±æ–‡ï¼‰</label>
                                    <input type="text" 
                                           name="contact_value_en" 
                                           id="contact_value_en" 
                                           value="{{ item.get_translated_content('en').get('value', '') if item else '' }}"
                                           placeholder="å¯é€‰"
                                           class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- åŠŸèƒ½ç‰¹æ€§ç±»å‹ -->
                    <div id="feature_fields" class="content-fields" style="display: none;">
                        <div class="space-y-4">
                            <div>
                                <label for="feature_icon" class="block text-sm font-medium text-gray-700">å›¾æ ‡</label>
                                <input type="text" 
                                       name="feature_icon" 
                                       id="feature_icon" 
                                       value="{{ item.get_content().get('icon', '') if item else '' }}"
                                       placeholder="å¦‚ï¼šğŸ¦ æˆ– fas fa-bank"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="feature_title" class="block text-sm font-medium text-gray-700">æ ‡é¢˜ï¼ˆä¸­æ–‡ï¼‰</label>
                                <input type="text" 
                                       name="feature_title" 
                                       id="feature_title" 
                                       value="{{ item.get_content().get('title', '') if item else '' }}"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="feature_description" class="block text-sm font-medium text-gray-700">æè¿°ï¼ˆä¸­æ–‡ï¼‰</label>
                                <textarea name="feature_description" 
                                         id="feature_description" 
                                         rows="2"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_content().get('description', '') if item else '' }}</textarea>
                            </div>
                            <div>
                                <label for="feature_title_en" class="block text-sm font-medium text-gray-700">æ ‡é¢˜ï¼ˆè‹±æ–‡ï¼‰</label>
                                <input type="text" 
                                       name="feature_title_en" 
                                       id="feature_title_en" 
                                       value="{{ item.get_translated_content('en').get('title', '') if item else '' }}"
                                       placeholder="å¯é€‰"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="feature_description_en" class="block text-sm font-medium text-gray-700">æè¿°ï¼ˆè‹±æ–‡ï¼‰</label>
                                <textarea name="feature_description_en" 
                                         id="feature_description_en" 
                                         rows="2"
                                         placeholder="å¯é€‰"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_translated_content('en').get('description', '') if item else '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- FAQç±»å‹ -->
                    <div id="faq_fields" class="content-fields" style="display: none;">
                        <div class="space-y-4">
                            <div>
                                <label for="faq_question" class="block text-sm font-medium text-gray-700">é—®é¢˜ï¼ˆä¸­æ–‡ï¼‰</label>
                                <input type="text" 
                                       name="faq_question" 
                                       id="faq_question" 
                                       value="{{ item.get_content().get('question', '') if item else '' }}"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="faq_answer" class="block text-sm font-medium text-gray-700">ç­”æ¡ˆï¼ˆä¸­æ–‡ï¼‰</label>
                                <textarea name="faq_answer" 
                                         id="faq_answer" 
                                         rows="3"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_content().get('answer', '') if item else '' }}</textarea>
                            </div>
                            <div>
                                <label for="faq_question_en" class="block text-sm font-medium text-gray-700">é—®é¢˜ï¼ˆè‹±æ–‡ï¼‰</label>
                                <input type="text" 
                                       name="faq_question_en" 
                                       id="faq_question_en" 
                                       value="{{ item.get_translated_content('en').get('question', '') if item else '' }}"
                                       placeholder="å¯é€‰"
                                       class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label for="faq_answer_en" class="block text-sm font-medium text-gray-700">ç­”æ¡ˆï¼ˆè‹±æ–‡ï¼‰</label>
                                <textarea name="faq_answer_en" 
                                         id="faq_answer_en" 
                                         rows="3"
                                         placeholder="å¯é€‰"
                                         class="mt-1 focus:ring-blue-500 focus:border-blue-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">{{ item.get_translated_content('en').get('answer', '') if item else '' }}</textarea>
                            </div>
                        </div>
                    </div>

                    <!-- ç±»å‹æœªé€‰æ‹©æ—¶çš„æç¤º -->
                    <div id="no_type_selected" class="text-center py-8 text-gray-500">
                        <i class="fas fa-arrow-up text-2xl mb-2"></i>
                        <p>è¯·å…ˆé€‰æ‹©ä¿¡æ¯é¡¹ç±»å‹</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="flex justify-end space-x-3">
            <a href="{{ url_for('admin.edit_section', section_id=(item.section_id if item else section.id)) }}" 
               class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                å–æ¶ˆ
            </a>
            <button type="submit" 
                    class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                {% if item %}ä¿å­˜ä¿®æ”¹{% else %}æ·»åŠ ä¿¡æ¯é¡¹{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
function toggleContentFields() {
    const itemType = document.getElementById('item_type').value;
    const contentFields = document.querySelectorAll('.content-fields');
    const noTypeSelected = document.getElementById('no_type_selected');
    
    // éšè—æ‰€æœ‰å†…å®¹å­—æ®µ
    contentFields.forEach(field => {
        field.style.display = 'none';
    });
    
    if (itemType) {
        // æ˜¾ç¤ºå¯¹åº”ç±»å‹çš„å­—æ®µ
        const targetField = document.getElementById(itemType + '_fields');
        if (targetField) {
            targetField.style.display = 'block';
        }
        noTypeSelected.style.display = 'none';
    } else {
        noTypeSelected.style.display = 'block';
    }
}

// é¡µé¢åŠ è½½æ—¶æ ¹æ®å½“å‰ç±»å‹æ˜¾ç¤ºå¯¹åº”å­—æ®µ
document.addEventListener('DOMContentLoaded', function() {
    toggleContentFields();
});
</script>
{% endblock %}