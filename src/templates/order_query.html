{% extends "base.html" %}
{% block title %}{{ _('Order Query') }} - {{ _('Sarah\'s Garage Sale') }}{% endblock %}

{% block content %}

<div class="max-w-4xl mx-auto">
  <!-- Page Header -->
  <div class="hero-section text-center mb-12">
    <h2 class="section-title mb-4">🔍 {{ _('Order Query') }}</h2>
    <p class="section-subtitle max-w-2xl mx-auto">
      {{ _('Check your order status and track delivery progress') }}
    </p>
  </div>
  
  <!-- 查询说明 -->
  <div class="card p-8 mb-8">
    <div class="flex items-start">
      <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mr-4 mt-1">
        <span class="text-white text-xl">💡</span>
      </div>
      <div>
        <h3 class="text-2xl font-semibold text-gray-800 mb-4">{{ _('How to Query Orders') }}</h3>
        <div class="grid md:grid-cols-3 gap-4">
          <div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-xl p-4 border border-blue-200">
            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-3">
              <span class="text-white font-bold">1</span>
            </div>
            <p class="text-blue-700 text-sm text-center">{{ _('Please enter the email address or phone number you provided when purchasing') }}</p>
          </div>
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-4 border border-green-200">
            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-3">
              <span class="text-white font-bold">2</span>
            </div>
            <p class="text-green-700 text-sm text-center">{{ _('The system will display all your orders and status information') }}</p>
          </div>
          <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 border border-purple-200">
            <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center mx-auto mb-3">
              <span class="text-white font-bold">3</span>
            </div>
            <p class="text-purple-700 text-sm text-center">{{ _('If you have any questions, please contact Sara directly: 0225255862') }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 查询表单 -->
  <div class="card p-8">
    <div class="text-center mb-6">
      <div class="w-16 h-16 bg-gradient-to-r from-pink-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-4">
        <span class="text-white text-2xl">📋</span>
      </div>
      <h3 class="text-2xl font-semibold text-gray-800">{{ _('Enter Your Contact Information') }}</h3>
    </div>
    
    <form method="POST" action="{{ url_for('main.order_query', lang=current_lang()) }}" class="space-y-6">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div>
        <label for="contact" class="block text-lg font-medium text-gray-700 mb-3">
          {{ _('Email Address or Phone Number') }} <span class="text-red-500">*</span>
        </label>
        <input 
          type="text" 
          id="contact" 
          name="contact" 
          required
          placeholder="{{ _('Please enter your email address or phone number') }}"
          class="w-full px-6 py-4 border-2 border-pink-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pink-300 focus:border-pink-300 bg-white/50 backdrop-blur-sm text-lg"
        >
        <div id="contact-feedback" class="mt-2"></div>
        <div class="mt-3 p-3 bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl border border-gray-200">
          <p class="text-sm text-gray-600">
            📝 {{ _('For example:') }} <span class="font-mono bg-white px-2 py-1 rounded">zhang@example.com</span> {{ _('or') }} <span class="font-mono bg-white px-2 py-1 rounded">021-234-567</span>
          </p>
        </div>
      </div>

      <!-- 验证提示 -->
      <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6">
        <div class="flex items-start">
          <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center mr-4 mt-1">
            <span class="text-white text-lg">⚠️</span>
          </div>
          <div>
            <p class="text-yellow-800 font-semibold text-lg mb-2">🔒 {{ _('Privacy Protection') }}</p>
            <p class="text-yellow-700">{{ _('To protect your privacy, please ensure you enter the actual contact information you used when purchasing.') }}</p>
          </div>
        </div>
      </div>

      <button 
        type="submit" 
        class="w-full btn-primary py-4 text-lg font-semibold"
      >
        🔍 {{ _('Query My Orders') }}
      </button>
    </form>
  </div>

  <!-- 其他联系方式 -->
  <div class="mt-12">
    <div class="text-center mb-8">
      <h3 class="text-2xl font-semibold text-gray-800 mb-4">🤔 {{ _('Can\'t Find Your Order?') }}</h3>
      <p class="text-gray-600">{{ _('You can also contact me directly through the following methods:') }}</p>
    </div>
    
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <a href="tel:0225255862" 
         class="card p-6 text-center hover:scale-105 transition-transform duration-300">
        <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <span class="text-white text-2xl">📞</span>
        </div>
        <h4 class="font-semibold text-gray-800 text-lg mb-2">{{ _('Phone Contact') }}</h4>
        <p class="text-green-600 font-bold text-xl mb-2">0225255862</p>
        <p class="text-gray-600 text-sm">{{ _('Working hours: 9:00-21:00') }}</p>
      </a>
      
      <a href="mailto:sarahliu.akl@gmail.com" 
         class="card p-6 text-center hover:scale-105 transition-transform duration-300">
        <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <span class="text-white text-2xl">✉️</span>
        </div>
        <h4 class="font-semibold text-gray-800 text-lg mb-2">{{ _('Email Contact') }}</h4>
        <p class="text-blue-600 font-bold text-lg mb-2">sarahliu.akl@gmail.com</p>
        <p class="text-gray-600 text-sm">{{ _('Reply within 24 hours') }}</p>
      </a>
    </div>
    
    <div class="mt-8 card p-6">
      <div class="text-center">
        <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mx-auto mb-4">
          <span class="text-white text-lg">✅</span>
        </div>
        <p class="text-gray-700 font-medium mb-2">{{ _('Promise to reply to your inquiries within 2 hours') }}</p>
        <p class="text-sm text-gray-600">{{ _('Business hours: Monday to Sunday 9:00-21:00') }}</p>
      </div>
    </div>
  </div>

  <!-- 常见问题 -->
  <div class="mt-8 card p-8">
    <div class="flex items-center mb-6">
      <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-4">
        <span class="text-white text-xl">❓</span>
      </div>
      <h3 class="text-2xl font-semibold text-gray-800">{{ _('Frequently Asked Questions') }}</h3>
    </div>
    
    <div class="space-y-6">
      <div class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 border border-blue-200">
        <h4 class="font-semibold text-gray-800 mb-3 text-lg">{{ _('Q: Why can\'t I find my order?') }}</h4>
        <p class="text-gray-600">📝 {{ _('A: Please confirm that the contact information you entered is consistent with what you provided when purchasing. If you still can\'t find it, there may be an error in order information entry, please contact us directly.') }}</p>
      </div>
      
      <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 border border-green-200">
        <h4 class="font-semibold text-gray-800 mb-3 text-lg">{{ _('Q: What are the order statuses?') }}</h4>
        <p class="text-gray-600 mb-3">📋 {{ _('A: Order statuses include the following:') }}</p>
        <div class="flex flex-wrap gap-2">
          <span class="bg-gradient-to-r from-yellow-100 to-orange-100 text-yellow-800 px-4 py-2 rounded-full text-sm font-medium">🕰️ {{ _('Pending Payment') }}</span>
          <span class="bg-gradient-to-r from-blue-100 to-cyan-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">💳 {{ _('Paid') }}</span>
          <span class="bg-gradient-to-r from-purple-100 to-pink-100 text-purple-800 px-4 py-2 rounded-full text-sm font-medium">🚚 {{ _('Shipped') }}</span>
          <span class="bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium">✅ {{ _('Completed') }}</span>
        </div>
      </div>
      
      <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6 border border-purple-200">
        <h4 class="font-semibold text-gray-800 mb-3 text-lg">{{ _('Q: How to modify order information?') }}</h4>
        <p class="text-gray-600">📞 {{ _('A: Please contact Sara directly to modify order information. To ensure accuracy, phone communication is recommended.') }}</p>
      </div>
    </div>
  </div>
</div>

<!-- 显示Flash消息 -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="fixed top-8 right-8 z-50 space-y-3">
      {% for category, message in messages %}
        <div class="p-4 rounded-2xl shadow-2xl border backdrop-blur-md transition-all duration-300 {{ 'bg-green-500/90 text-white border-green-400' if category == 'success' else 'bg-red-500/90 text-white border-red-400' if category == 'error' else 'bg-blue-500/90 text-white border-blue-400' }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
    
    <script>
      // 3秒后自动隐藏消息
      setTimeout(function() {
        const messages = document.querySelectorAll('.fixed.top-8.right-8 > div');
        messages.forEach(msg => {
          msg.style.transform = 'translateX(100%)';
          setTimeout(() => msg.remove(), 300);
        });
      }, 3000);
    </script>
  {% endif %}
{% endwith %}

<!-- 包含验证脚本 -->
<script src="{{ url_for('static', filename='js/toast.js') }}"></script>
<script src="{{ url_for('static', filename='js/validation.js') }}"></script>

<script>
// 页面加载完成后初始化验证
document.addEventListener('DOMContentLoaded', function() {
  const contactInput = document.getElementById('contact');
  const contactFeedback = document.getElementById('contact-feedback');
  const orderForm = document.querySelector('form[method="POST"]');
  
  console.log('初始化验证...', {contactInput, contactFeedback, orderForm});
  
  // 确保验证函数已加载
  if (typeof validateEmailOrPhone === 'undefined') {
    console.error('验证函数未加载！');
    return;
  }
  
  // 实时验证
  function validateInput() {
    const value = contactInput.value;
    const result = validateEmailOrPhone(value);
    
    // 更新输入框样式
    contactInput.classList.remove('border-red-500', 'border-green-500', 'border-pink-200');
    
    if (value.trim() === '') {
      contactInput.classList.add('border-pink-200');
      contactFeedback.textContent = '';
    } else if (result.isValid) {
      contactInput.classList.add('border-green-500');
      contactFeedback.textContent = '✅ ' + result.message;
      contactFeedback.className = 'text-green-600 text-sm mt-2';
    } else {
      contactInput.classList.add('border-red-500');
      contactFeedback.textContent = '❌ ' + result.message;
      contactFeedback.className = 'text-red-600 text-sm mt-2';
    }
    
    return result;
  }
  
  // 绑定实时验证事件
  contactInput.addEventListener('input', validateInput);
  contactInput.addEventListener('blur', validateInput);
  
  // 表单提交验证
  orderForm.addEventListener('submit', function(event) {
    console.log('表单提交验证开始...');
    
    const value = contactInput.value.trim();
    
    // 检查是否为空
    if (!value) {
      event.preventDefault();
      showValidationError('Please enter your email address or phone number', 'Contact Information');
      contactInput.focus();
      return false;
    }
    
    // 验证格式
    const result = validateEmailOrPhone(value);
    
    if (!result.isValid) {
      event.preventDefault();
      showValidationError(result.message, 'Contact Information');
      contactInput.focus();
      return false;
    }
    
    console.log('验证通过，提交表单');
    return true;
  });
  
  console.log('验证初始化完成');
});
</script>

{% endblock %}